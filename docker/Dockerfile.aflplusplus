FROM aflplusplus/aflplusplus

ARG USER_ID
ARG GROUP_ID

RUN apt-get update && apt-get install -y sudo

WORKDIR /AFLplusplus
RUN make afl-showmap afl-fuzz
WORKDIR /AFLplusplus/qemu_mode
RUN CPU_TARGET=i386 ./build_qemu_support.sh

RUN addgroup --gid $GROUP_ID user
RUN adduser --disabled-password --gecos '' --uid $USER_ID --gid $GROUP_ID user
RUN adduser user sudo
RUN echo '%sudo ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers

WORKDIR /AFLplusplus
USER user

ENTRYPOINT ["tail", "-f", "/dev/null"]
