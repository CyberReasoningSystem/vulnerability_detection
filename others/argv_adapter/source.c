#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define IS_LOGGING 1
#define LOG(format, ...)                                                       \
  if (IS_LOGGING)                                                              \
  printf(format, ##__VA_ARGS__)
#define MAX_ARGUMENTS 10
#define MAX_BUFFER_SIZE 1024

int main(int argc, char *argv[]) {
  char *program_argv[MAX_ARGUMENTS], **argv_with_format;
  char argument[MAX_BUFFER_SIZE];
  char *found_argument;
  int counter = 0, format_index, argument_size;

  // Check the arguments number
  if (argc != 3) {
    return -1;
  }

  // Read the string to be used in the format string
  read(STDIN_FILENO, argument, MAX_BUFFER_SIZE);

  // Split the given arguments
  program_argv[0] = argv[1];
  counter = 1;
  while ((found_argument = strsep(&argv[2], " ")) != NULL) {
    LOG("New argument extracted: %s\n", found_argument);

    if (strcmp(found_argument, "%s") == 0) {
      program_argv[counter] = argument;
    } else {
      argument_size = strlen(found_argument) + 1;
      program_argv[counter] = (char *)malloc(argument_size * sizeof(char));

      strcpy(program_argv[counter], found_argument);
    }

    counter++;
  }
  program_argv[counter] = NULL;

  // Log the arguments
  LOG("Executed program: %s\n", program_argv[0]);
  for (int i = 0; i < counter; i++) {
    LOG("Given argument: %s\n", program_argv[i]);
  }

  // Launch the executable
  if (execve(program_argv[0], program_argv, NULL) == -1)
    LOG("Could not run the program");

  return 0;
}