# Set the base image
FROM aflplusplus/aflplusplus

# Set the arguments
ARG USER_ID
ARG GROUP_ID

# Install sudo
RUN apt-get update && apt-get install -y sudo

# Add the QEMU support
WORKDIR /AFLplusplus
RUN make afl-showmap
WORKDIR /AFLplusplus/qemu_mode
RUN ./build_qemu_support.sh

# Create a new user in a new group
RUN addgroup --gid $GROUP_ID user
RUN adduser --disabled-password --gecos '' --uid $USER_ID --gid $GROUP_ID user
RUN adduser user sudo
RUN echo '%sudo ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers

# Switch to the newly created user
USER user

# Set the entry point
ENTRYPOINT ["tail", "-f", "/dev/null"]